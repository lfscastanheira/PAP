{"ast":null,"code":"var _jsxFileName = \"/Users/enzogrigorio/Library/CloudStorage/OneDrive-ColegiodeGaia/Ambiente de Trabalho/fct/etrainit/backoffice.v3/src/pages/Admin/Calendar/index.jsx\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState, useRef } from 'react';\nimport Calendar from '@event-calendar/core';\nimport TimeGrid from '@event-calendar/time-grid';\nimport Interaction from '@event-calendar/interaction';\nimport DayGrid from '@event-calendar/day-grid';\nimport List from '@event-calendar/list';\nimport '@event-calendar/core/index.css';\nimport { calendarConfig, handleDateClick } from './calendar-configs-functions';\nimport Popup from '../popup/Popup';\nimport './calendar.css';\nimport { useNavigate } from 'react-router-dom';\nimport { getEventos, updateEventColor } from '../../services/api';\nimport Swal from 'sweetalert2';\nimport { vermelho, verde } from '../../configs/configs';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst Calendario = idProfessor => {\n  _s();\n  const [popupOptions, setPopupOptions] = useState(null);\n  const [showPopup, setShowPopup] = useState(false);\n  const [backendData, setBackendData] = useState([]);\n  const [calendarInitialized, setCalendarInitialized] = useState(false);\n  const navigate = useNavigate();\n  const calendarRef = useRef(null);\n  const [loading, setLoading] = useState(true);\n  function verificarEventosParaAtualizacao() {\n    const eventosParaAtualizar = backendData.filter(evento => {\n      const dataFinal = new Date(evento.end).getTime();\n      const agora = new Date().getTime();\n      return dataFinal < agora && evento.extendedProps.sumario.trim() === '';\n    });\n    eventosParaAtualizar.forEach(async evento => {\n      try {\n        // Atualiza a cor do evento na base de dados via chamada à API\n        let cor = vermelho;\n        await updateEventColor(evento.id, cor);\n        console.log(`Cor do evento ${evento.id} atualizada.`);\n      } catch (error) {\n        console.error(`Erro ao atualizar a cor do evento ${evento.id}:`, error);\n      }\n    });\n  }\n  let contErros = 0;\n  useEffect(() => {\n    async function fetchEvents() {\n      try {\n        const events = await getEventos(idProfessor.idProfessor);\n        const renamedEvents = events.map(event => {\n          event.id = event._id;\n          delete event._id;\n          return event;\n        });\n        if (renamedEvents.length === 0) {\n          if (contErros !== 1) {\n            Swal.fire({\n              icon: 'error',\n              title: 'Nenhum evento encontrado para o professor associado.',\n              showConfirmButton: false,\n              timer: 1500\n            });\n          }\n          contErros += 1;\n        }\n        setLoading(false);\n        setBackendData(renamedEvents);\n        //createCalendar()\n      } catch (error) {\n        console.error('Erro ao buscar eventos do backend:', error);\n      }\n    }\n    fetchEvents();\n  }, []);\n  useEffect(() => {\n    const agora = new Date().getTime();\n    console.log(backendData);\n    for (let i = 0; i < backendData.length; i++) {\n      const dataFinal = new Date(backendData[i].end).getTime();\n    }\n    if (!calendarInitialized && backendData.length > 0) {\n      createCalendar();\n    } else if (calendarInitialized) {\n      calendarRef.current.destroy();\n      createCalendar();\n    }\n  }, [backendData]);\n  const createCalendar = () => {\n    calendarRef.current = new Calendar({\n      target: document.getElementById('ec'),\n      props: {\n        plugins: [TimeGrid, Interaction, DayGrid, List],\n        options: {\n          ...calendarConfig,\n          events: backendData,\n          dateClick: info => {\n            handleDateClick(info, setPopupOptions, setShowPopup);\n          },\n          eventClick: info => {\n            let tempId = info.event.id;\n            if (!tempId.includes(\"generated\")) {\n              navigate('../../Evento?id=' + info.event.id);\n            }\n          }\n        }\n      }\n    });\n    setCalendarInitialized(true);\n  };\n  const handleClosePopup = () => {\n    setShowPopup(false);\n  };\n  const updateEvents = async () => {\n    try {\n      const events = await getEventos(\"all\");\n      setBackendData(events);\n    } catch (error) {\n      console.error('Erro ao buscar eventos do backend:', error);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [loading ? /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"divDoLoader\",\n      children: /*#__PURE__*/_jsxDEV(\"svg\", {\n        viewBox: \"25 25 50 50\",\n        children: /*#__PURE__*/_jsxDEV(\"circle\", {\n          r: \"20\",\n          cy: \"50\",\n          cx: \"50\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 152,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 151,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 9\n    }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"calendar\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"ec\",\n        id: \"ec\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 157,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 156,\n      columnNumber: 9\n    }, this), showPopup && /*#__PURE__*/_jsxDEV(Popup, {\n      popupOptions: popupOptions,\n      onClose: handleClosePopup,\n      updateEvents: updateEvents\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 160,\n      columnNumber: 21\n    }, this)]\n  }, void 0, true);\n};\n_s(Calendario, \"1dBKonXP2Lp9eBNuDBsmdHP74s8=\", false, function () {\n  return [useNavigate];\n});\n_c = Calendario;\nexport default Calendario;\nvar _c;\n$RefreshReg$(_c, \"Calendario\");","map":{"version":3,"names":["React","useEffect","useState","useRef","Calendar","TimeGrid","Interaction","DayGrid","List","calendarConfig","handleDateClick","Popup","useNavigate","getEventos","updateEventColor","Swal","vermelho","verde","jsxDEV","_jsxDEV","Fragment","_Fragment","Calendario","idProfessor","_s","popupOptions","setPopupOptions","showPopup","setShowPopup","backendData","setBackendData","calendarInitialized","setCalendarInitialized","navigate","calendarRef","loading","setLoading","verificarEventosParaAtualizacao","eventosParaAtualizar","filter","evento","dataFinal","Date","end","getTime","agora","extendedProps","sumario","trim","forEach","cor","id","console","log","error","contErros","fetchEvents","events","renamedEvents","map","event","_id","length","fire","icon","title","showConfirmButton","timer","i","createCalendar","current","destroy","target","document","getElementById","props","plugins","options","dateClick","info","eventClick","tempId","includes","handleClosePopup","updateEvents","children","className","viewBox","r","cy","cx","fileName","_jsxFileName","lineNumber","columnNumber","onClose","_c","$RefreshReg$"],"sources":["/Users/enzogrigorio/Library/CloudStorage/OneDrive-ColegiodeGaia/Ambiente de Trabalho/fct/etrainit/backoffice.v3/src/pages/Admin/Calendar/index.jsx"],"sourcesContent":["import React, { useEffect, useState, useRef } from 'react';\nimport Calendar from '@event-calendar/core';\nimport TimeGrid from '@event-calendar/time-grid';\nimport Interaction from '@event-calendar/interaction';\nimport DayGrid from '@event-calendar/day-grid';\nimport List from '@event-calendar/list';\nimport '@event-calendar/core/index.css';\nimport { calendarConfig, handleDateClick } from './calendar-configs-functions';\nimport Popup from '../popup/Popup';\nimport './calendar.css';\nimport { useNavigate } from 'react-router-dom';\nimport { getEventos, updateEventColor } from '../../services/api';\nimport Swal from 'sweetalert2';\nimport { vermelho, verde } from '../../configs/configs'\n\n\nconst Calendario = (idProfessor) => {\n  \n  const [popupOptions, setPopupOptions] = useState(null);\n  const [showPopup, setShowPopup] = useState(false);\n  const [backendData, setBackendData] = useState([]);\n  const [calendarInitialized, setCalendarInitialized] = useState(false);\n  const navigate = useNavigate();\n  const calendarRef = useRef(null);\n\n  const [loading, setLoading] = useState(true);\n\n\n  function verificarEventosParaAtualizacao() {\n    const eventosParaAtualizar = backendData.filter((evento) => {\n      const dataFinal = new Date(evento.end).getTime();\n      const agora = new Date().getTime();\n      return dataFinal < agora && evento.extendedProps.sumario.trim() === '';\n    });\n  \n    eventosParaAtualizar.forEach(async (evento) => {\n      try {\n        // Atualiza a cor do evento na base de dados via chamada à API\n        let cor = vermelho\n        await updateEventColor(evento.id, cor);\n        console.log(`Cor do evento ${evento.id} atualizada.`);\n      } catch (error) {\n        \n        console.error(`Erro ao atualizar a cor do evento ${evento.id}:`, error);\n      }\n    });\n  }\n  \n  \n\n  \n\n  let contErros = 0;\n  useEffect(() => {\n    async function fetchEvents() {\n      try {\n        const events = await getEventos(idProfessor.idProfessor);\n  \n        const renamedEvents = events.map((event) => {\n          event.id = event._id;\n          delete event._id;\n          \n          return event;\n        });\n  \n        if (renamedEvents.length === 0) {\n          if (contErros !== 1) {\n            Swal.fire({\n              icon: 'error',\n              title: 'Nenhum evento encontrado para o professor associado.',\n              showConfirmButton: false,\n              timer: 1500,\n            });\n          }\n          contErros += 1;\n        }\n  \n        setLoading(false);\n        setBackendData(renamedEvents);\n        //createCalendar()\n      } catch (error) {\n        console.error('Erro ao buscar eventos do backend:', error);\n      }\n    }\n  \n    fetchEvents();\n  }, []);\n  \n  \n\n  useEffect(() => {\n    const agora = new Date().getTime();\n\n    console.log(backendData)\n    for(let i = 0; i < backendData.length; i++){\n      const dataFinal = new Date(backendData[i].end).getTime();\n\n      \n    }\n    if (!calendarInitialized && backendData.length > 0) {\n      createCalendar();\n    } else if (calendarInitialized) {\n      calendarRef.current.destroy();\n      createCalendar();\n    }\n  }, [backendData]);\n\n  const createCalendar = () => {\n    calendarRef.current = new Calendar({\n      target: document.getElementById('ec'),\n      props: {\n        plugins: [TimeGrid, Interaction, DayGrid, List],\n        options: {\n          ...calendarConfig,\n          events: backendData,\n          dateClick: (info) => {\n            handleDateClick(info, setPopupOptions, setShowPopup);\n          },\n          eventClick: (info) => {\n            \n            let tempId = info.event.id\n            if(!(tempId.includes(\"generated\"))){\n              navigate('../../Evento?id=' + info.event.id);\n            }\n          },\n        },\n      },\n    });\n\n    setCalendarInitialized(true);\n  };\n\n  const handleClosePopup = () => {\n    setShowPopup(false);\n  };\n\n  const updateEvents = async () => {\n    try {\n      const events = await getEventos(\"all\");\n      \n      setBackendData(events);\n    } catch (error) {\n      console.error('Erro ao buscar eventos do backend:', error);\n    }\n  };\n\n  return (\n    <>\n      {loading ? ( \n        <div className='divDoLoader'>\n          <svg viewBox=\"25 25 50 50\">\n          <circle r=\"20\" cy=\"50\" cx=\"50\"></circle>\n          </svg>\n        </div>\n      ) : (\n        <div className=\"calendar\">\n          <div className=\"ec\" id=\"ec\"></div>\n        </div>\n      )}\n      {showPopup && <Popup popupOptions={popupOptions} onClose={handleClosePopup} updateEvents={updateEvents} />}\n    </>\n  );\n};\n\nexport default Calendario;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}